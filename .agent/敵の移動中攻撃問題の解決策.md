# æ•µãŒç§»å‹•ä¸­ã«å‰£ã‚’æŒ¯ã‚‹å•é¡Œã®è§£æ±ºç­–

## ğŸ› å•é¡Œã®è©³ç´°

### ç¾è±¡
æ•µãŒç§»å‹•ä¸­(ChaseçŠ¶æ…‹)ã«æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œã€å‰£ã‚’æŒ¯ã‚ŠãªãŒã‚‰è¿½ã„ã‹ã‘ã¦ãã‚‹ã€‚

### åŸå› 
ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã€ã¾ãŸã¯è¤‡æ•°ãŒåŸå› ã¨è€ƒãˆã‚‰ã‚Œã¾ã™:

1. **Animatorã®è¨­å®šå•é¡Œ**
   - "Any State â†’ Attack" ã®TransitionãŒå¸¸ã«æœ‰åŠ¹
   - Transitionã®æ¡ä»¶ãŒç·©ã™ãã‚‹

2. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ**
   - `Attack`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ„å›³ã›ãš1.0ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
   - çŠ¶æ…‹é·ç§»ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œã¦ã„ã‚‹

3. **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®å•é¡Œ**
   - `AttackEnd()`ãŒå‘¼ã°ã‚Œãšã«`Attack`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ0ã«æˆ»ã‚‰ãªã„

---

## âœ… è§£æ±ºç­–

### è§£æ±ºç­–1: Animatorã®è¨­å®šã‚’ä¿®æ­£ã€æ¨å¥¨ã€‘

#### å•é¡Œã®ã‚ã‚‹è¨­å®š
```
Any State â†’ Attack
- Condition: Attack > 0.5
- Can Transition To Self: true  â† ã“ã‚ŒãŒå•é¡Œ
```

#### æ­£ã—ã„è¨­å®š

**æ–¹æ³•A: Any Stateã‚’ä½¿ã‚ãªã„ (æ¨å¥¨)**

```
Movement/Idle State â†’ Attack State
- Condition: Attack > 0.5
- Has Exit Time: false
- Transition Duration: 0.1s
- Interruption Source: None

Attack State â†’ Movement/Idle State
- Condition: Attack < 0.5
- Has Exit Time: true
- Exit Time: 1.0
- Transition Duration: 0.2s
```

**æ–¹æ³•B: Any Stateã‚’ä½¿ã†å ´åˆ**

```
Any State â†’ Attack
- Condition: Attack > 0.5
- Can Transition To Self: false  â† é‡è¦!
- Has Exit Time: false
- Transition Duration: 0.1s

Attack â†’ Idle/Movement
- Condition: Attack < 0.5
- Has Exit Time: true
- Exit Time: 1.0
- Transition Duration: 0.2s
```

---

### è§£æ±ºç­–2: Boolãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹

#### ç¾åœ¨ã®å•é¡Œ
`Attack`ãŒFloatå‹ã®ãŸã‚ã€å€¤ã®å¤‰åŒ–ãŒæ›–æ˜§ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### æ”¹å–„æ¡ˆ: Boolãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¤‰æ›´

**Animatorãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›´:**
```
Attack (Float) â†’ IsAttacking (Bool)
```

**Enemystate1.csã®ä¿®æ­£:**

```csharp
void UpdateAnimator()
{
    if (animator == null) return;

    // å…¨ã¦ã®çŠ¶æ…‹ã§ã¾ãšIsAttackingã‚’falseã«
    animator.SetBool("IsAttacking", false);

    switch (currentState)
    {
        case EnemyState.Idle:
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
            
        case EnemyState.Chase:
            // ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ChasePlayer()ã§æ›´æ–°
            break;
            
        case EnemyState.Approach:
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
            
        case EnemyState.Attack:
            animator.SetBool("IsAttacking", true);  // æ”»æ’ƒçŠ¶æ…‹ã®ã¿true
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
            
        case EnemyState.Cooldown:
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
    }
}
```

**Enemykinsetu1.csã®ä¿®æ­£:**

```csharp
public void AttackEnd()
{
    // Boolãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
    animator.SetBool("IsAttacking", false);
}
```

**Animator Transitionã®è¨­å®š:**
```
Movement â†’ Attack
- Condition: IsAttacking == true
- Has Exit Time: false

Attack â†’ Movement
- Condition: IsAttacking == false
- Has Exit Time: true
- Exit Time: 1.0
```

---

### è§£æ±ºç­–3: Triggerãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ã€æœ€ã‚‚ç¢ºå®Ÿã€‘

#### ç‰¹å¾´
- ä¸€åº¦ã ã‘ç™ºç«ã™ã‚‹
- è‡ªå‹•çš„ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
- æ„å›³ã—ãªã„å†ç”Ÿã‚’é˜²ã’ã‚‹

#### å®Ÿè£…æ–¹æ³•

**Animatorãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰æ›´:**
```
Attack (Float) â†’ AttackTrigger (Trigger)
```

**Enemystate1.csã®ä¿®æ­£:**

```csharp
void UpdateAnimator()
{
    if (animator == null) return;

    switch (currentState)
    {
        case EnemyState.Idle:
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
            
        case EnemyState.Chase:
            // ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ChasePlayer()ã§æ›´æ–°
            break;
            
        case EnemyState.Approach:
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
            
        case EnemyState.Attack:
            // Triggerã¯ä¸€åº¦ã ã‘ç™ºç«
            animator.SetTrigger("AttackTrigger");
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
            
        case EnemyState.Cooldown:
            animator.SetFloat("MoveX", 0f);
            animator.SetFloat("MoveZ", 0f);
            break;
    }
}
```

**Enemykinsetu1.csã®ä¿®æ­£:**

```csharp
public void AttackEnd()
{
    // Triggerã®å ´åˆã¯ä½•ã‚‚ã—ãªãã¦OK (è‡ªå‹•çš„ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹)
    // animator.SetFloat("Attack", 0f); â† ä¸è¦
}
```

**Animator Transitionã®è¨­å®š:**
```
Movement â†’ Attack
- Condition: AttackTrigger (TriggerãŒç™ºç«ã—ãŸã‚‰)
- Has Exit Time: false
- Transition Duration: 0.1s

Attack â†’ Movement
- Condition: ãªã—
- Has Exit Time: true
- Exit Time: 1.0
- Transition Duration: 0.2s
```

---

### è§£æ±ºç­–4: çŠ¶æ…‹é·ç§»ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ”¹å–„

#### å•é¡Œ
`Attack`çŠ¶æ…‹ã«å…¥ã£ãŸç›´å¾Œã«`Cooldown`ã«é·ç§»ã™ã‚‹ãŸã‚ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸­æ–­ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### æ”¹å–„æ¡ˆ

**Enemystate1.csã®ä¿®æ­£:**

```csharp
public int EnemyAIaction()
{
    if (player == null) return (int)currentState;

    float distance = Vector3.Distance(transform.position, player.transform.position);

    switch (currentState)
    {
        case EnemyState.Idle:
            if (distance <= detectionRange)
            {
                currentState = EnemyState.Chase;
            }
            UpdateAnimator();
            break;

        case EnemyState.Chase:
            if (distance > chaseRange)
            {
                currentState = EnemyState.Idle;
            }
            else if (distance <= attackRange && attackCooldownTimer <= 0)
            {
                currentState = EnemyState.Approach;
            }
            else
            {
                ChasePlayer();
            }
            UpdateAnimator();
            break;

        case EnemyState.Approach:
            FacePlayer();
            if (IsPlayerInFront(30f))
            {
                currentState = EnemyState.Attack;
                isAttacking = true;  // ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
            }
            UpdateAnimator();
            break;

        case EnemyState.Attack:
            // æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã¯çŠ¶æ…‹ã‚’å¤‰ãˆãªã„
            // AttackEndã‚¤ãƒ™ãƒ³ãƒˆã§æ¬¡ã®çŠ¶æ…‹ã«é·ç§»
            UpdateAnimator();
            break;

        case EnemyState.Cooldown:
            if (attackCooldownTimer <= 0)
            {
                isAttacking = false;
                currentState = distance <= attackRange ? EnemyState.Approach : EnemyState.Chase;
            }
            UpdateAnimator();
            break;
    }

    return (int)currentState;
}
```

**Enemykinsetu1.csã®ä¿®æ­£:**

```csharp
using UnityEngine;

public class Enemykinsetu1 : MonoBehaviour, ICharaAttack
{
    Animator animator;
    Enemystate1 enemyState;  // è¿½åŠ 
    int Hcount;
    bool Attacktime;

    public int HitCount() => Hcount;
    
    public void HitCountdown()
    {
        if(Hcount > 0) --Hcount;
    }
    
    public bool Attacktimeinspection() => Attacktime;

    void Start()
    {
        animator = GetComponent<Animator>();
        enemyState = GetComponent<Enemystate1>();  // è¿½åŠ 
    }

    public void AttackStart()
    {
        Hcount = 1;
        Attacktime = true;
    }

    public void Hit()
    {
        Hcount = 0;
        Attacktime = false;
    }

    public void AttackEnd()
    {
        animator.SetFloat("Attack", 0f);
        
        // æ”»æ’ƒçµ‚äº†å¾Œã«CooldownçŠ¶æ…‹ã«é·ç§»
        if (enemyState != null)
        {
            // Enemystate1ã«CooldownçŠ¶æ…‹ã«é·ç§»ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
            // ã¾ãŸã¯ã€ã“ã“ã§ç›´æ¥çŠ¶æ…‹ã‚’å¤‰æ›´
        }
    }
}
```

---

## ğŸ¯ æ¨å¥¨ã•ã‚Œã‚‹å®Ÿè£…æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: Triggerãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¤‰æ›´ã€æœ€å„ªå…ˆã€‘

1. **Animatorãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¤‰æ›´**
   - `Attack` (Float) ã‚’å‰Šé™¤
   - `AttackTrigger` (Trigger) ã‚’è¿½åŠ 

2. **Enemystate1.csã‚’ä¿®æ­£**
   ```csharp
   case EnemyState.Attack:
       animator.SetTrigger("AttackTrigger");
       animator.SetFloat("MoveX", 0f);
       animator.SetFloat("MoveZ", 0f);
       break;
   ```

3. **Enemykinsetu1.csã‚’ä¿®æ­£**
   ```csharp
   public void AttackEnd()
   {
       // Triggerã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
       // è‡ªå‹•çš„ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹
   }
   ```

### ã‚¹ãƒ†ãƒƒãƒ—2: Animator Transitionã‚’ä¿®æ­£

1. **Any State â†’ Attackã‚’å‰Šé™¤** (ä½¿ã£ã¦ã„ã‚‹å ´åˆ)

2. **Movement â†’ Attackã‚’ä½œæˆ**
   ```
   Condition: AttackTrigger
   Has Exit Time: false
   Transition Duration: 0.1s
   Interruption Source: None
   ```

3. **Attack â†’ Movementã‚’ä½œæˆ**
   ```
   Condition: ãªã—
   Has Exit Time: true
   Exit Time: 1.0
   Transition Duration: 0.2s
   ```

### ã‚¹ãƒ†ãƒƒãƒ—3: çŠ¶æ…‹é·ç§»ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’èª¿æ•´

**Enemystate1.csã®ä¿®æ­£:**

```csharp
case EnemyState.Attack:
    // ä¸€åº¦ã ã‘Triggerã‚’ç™ºç«
    if (!isAttacking)
    {
        animator.SetTrigger("AttackTrigger");
        isAttacking = true;
        attackCooldownTimer = attackCooldown;
    }
    
    // ç§»å‹•ã‚’åœæ­¢
    animator.SetFloat("MoveX", 0f);
    animator.SetFloat("MoveZ", 0f);
    
    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã§Cooldownã«é·ç§»ã™ã‚‹ã®ã‚’å¾…ã¤
    // (AttackEndã§çŠ¶æ…‹ã‚’å¤‰æ›´)
    break;
```

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### 1. Animatorãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç¢ºèª

```csharp
void UpdateAnimator()
{
    if (animator == null) return;

    // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ 
    Debug.Log($"[{Time.time}] State: {currentState}, Attack: {animator.GetFloat("Attack")}");

    // ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰
}
```

### 2. çŠ¶æ…‹é·ç§»ã®ç¢ºèª

```csharp
public int EnemyAIaction()
{
    if (player == null) return (int)currentState;

    float distance = Vector3.Distance(transform.position, player.transform.position);
    
    // çŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸæ™‚ã ã‘ãƒ­ã‚°å‡ºåŠ›
    EnemyState previousState = currentState;

    // ... çŠ¶æ…‹é·ç§»ã®ãƒ­ã‚¸ãƒƒã‚¯

    if (previousState != currentState)
    {
        Debug.Log($"[{Time.time}] State changed: {previousState} â†’ {currentState}");
    }

    return (int)currentState;
}
```

### 3. Animatorã®çŠ¶æ…‹ã‚’å¯è¦–åŒ–

Unityã‚¨ãƒ‡ã‚£ã‚¿ã§:
1. Playãƒ¢ãƒ¼ãƒ‰ä¸­ã«Enemyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
2. Animatorã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã
3. ã©ã®çŠ¶æ…‹ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹ç¢ºèª
4. Parametersã‚¿ãƒ–ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã‚’ç¢ºèª

---

## ğŸ“Š å„è§£æ±ºç­–ã®æ¯”è¼ƒ

| è§£æ±ºç­– | å®Ÿè£…é›£æ˜“åº¦ | ç¢ºå®Ÿæ€§ | æ¨å¥¨åº¦ |
|--------|-----------|--------|--------|
| 1. Animatorè¨­å®šä¿®æ­£ | â­ ç°¡å˜ | â­â­ æ™®é€š | â­â­ |
| 2. Boolãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | â­â­ æ™®é€š | â­â­â­ é«˜ã„ | â­â­â­ |
| 3. Triggerãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | â­â­ æ™®é€š | â­â­â­â­ æœ€é«˜ | â­â­â­â­ |
| 4. çŠ¶æ…‹é·ç§»æ”¹å–„ | â­â­â­ é›£ã—ã„ | â­â­â­ é«˜ã„ | â­â­â­ |

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å®Ÿè£…å¾Œã«ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:

- [ ] å¾…æ©ŸçŠ¶æ…‹ã§æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œãªã„
- [ ] è¿½è·¡çŠ¶æ…‹ã§æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œãªã„
- [ ] æ¥è¿‘çŠ¶æ…‹ã§æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œãªã„
- [ ] æ”»æ’ƒçŠ¶æ…‹ã§ã®ã¿æ”»æ’ƒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†ç”Ÿã•ã‚Œã‚‹
- [ ] æ”»æ’ƒå¾Œã«ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³çŠ¶æ…‹ã«é·ç§»ã™ã‚‹
- [ ] ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³å¾Œã«é©åˆ‡ãªçŠ¶æ…‹ã«æˆ»ã‚‹
- [ ] ç§»å‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãå†ç”Ÿã•ã‚Œã‚‹
- [ ] Gizmosã§çŠ¶æ…‹ãŒç¢ºèªã§ãã‚‹

---

## ğŸ¯ ã¾ã¨ã‚

### æœ€ã‚‚ç¢ºå®Ÿãªè§£æ±ºæ–¹æ³•

**Triggerãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã™ã‚‹ (è§£æ±ºç­–3)**

1. âœ… ä¸€åº¦ã ã‘ç™ºç«ã™ã‚‹ãŸã‚ã€æ„å›³ã—ãªã„å†ç”Ÿã‚’é˜²ã’ã‚‹
2. âœ… è‡ªå‹•çš„ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ãŸã‚ã€ç®¡ç†ãŒç°¡å˜
3. âœ… Unityã®æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³
4. âœ… å®Ÿè£…ãŒæ¯”è¼ƒçš„ç°¡å˜

### å®Ÿè£…ã®å„ªå…ˆé †ä½

1. **æœ€å„ªå…ˆ**: Triggerãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å¤‰æ›´
2. **æ¬¡**: Animator Transitionã®ä¿®æ­£
3. **æœ€å¾Œ**: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã§å‹•ä½œç¢ºèª

ã“ã®æ‰‹é †ã«å¾“ãˆã°ã€ç§»å‹•ä¸­ã«å‰£ã‚’æŒ¯ã‚‹å•é¡Œã‚’ç¢ºå®Ÿã«è§£æ±ºã§ãã¾ã™!
